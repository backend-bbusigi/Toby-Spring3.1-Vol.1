# 3ì¥_í…œí”Œë¦¿

---
[ğŸ“– ë…¸ì…˜ ë§í¬](https://far-chess-c7b.notion.site/3-_-04b076cfe78542a585059b33ded4d6b7?pvs=4)

> ğŸ’¡
> **í…œí”Œë¦¿**
> 
> ì½”ë“œ ì¤‘ì—ì„œ ë³€ê²½ì´ ê±°ì˜ ì¼ì–´ë‚˜ì§€ ì•Šìœ¼ë©° ì¼ì •í•œ íŒ¨í„´ìœ¼ë¡œ ìœ ì§€ë˜ëŠ” íŠ¹ì„±ì„ ê°€ì§„ ë¶€ë¶„ì„ ììœ ë¡­ê²Œ ë³€ê²½ë˜ëŠ” ì„±ì§ˆì„ ê°€ì§„ ë¶€ë¶„ìœ¼ë¡œë¶€í„° `ë…ë¦½`ì‹œì¼œì„œ íš¨ê³¼ì ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë°©ë²•


# ì˜ˆì™¸ì²˜ë¦¬ ê¸°ëŠ¥ì„ ê°–ì¶˜ DAO

---

DB ì»¤ë„¥ì…˜ì€ ì œí•œì ì¸ ë¦¬ì†ŒìŠ¤ë¥¼ ê³µìœ í•´ ì‚¬ìš©í•˜ëŠ” ì„œë²„ì—ì„œ `ì˜ˆì™¸ì²˜ë¦¬` ë¥¼ ë°˜ë“œì‹œ í•´ì•¼í•œë‹¤.

## JDBC ìˆ˜ì • ê¸°ëŠ¥ì˜ ì˜ˆì™¸ì²˜ë¦¬

### ì˜ˆì™¸ì²˜ë¦¬ ì—†ëŠ” ì½”ë“œ

```java
public void deleteAll() throws SQLException {
    Connection c = dataSource.getConnection();
    
    PreparedStatement ps = c.prepareStatement("delete from users");
    ps.executeUpdate();
    
    ps.close();
    c.close();
}
```

**ë¬¸ì œì **

- `Connection`ê³¼ `PreparedStatement`ë¼ëŠ” ë‘ ê°œì˜ ê³µìœ  ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ”ë° ì²˜ë¦¬ ì¤‘ì— ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ `Connection`ê³¼ `PreparedStatement`ëŠ” `close`() ë©”ì†Œë“œê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•„ ë¦¬ì†ŒìŠ¤ê°€ ë°˜í™˜ë˜ì§€ ì•ŠëŠ”ë‹¤.

â†’ ì»¤ë„¥ì…˜ í’€ì— ì—¬ìœ ê°€ ì—†ì–´ì§€ê³ , ë¦¬ì†ŒìŠ¤ê°€ ëª¨ìë¼ì„œ ì„œë²„ê°€ ì¤‘ë‹¨ë  ìˆ˜ ìˆë‹¤.

### ì˜ˆì™¸ ì²˜ë¦¬ - try/catch/finally

```java
public void deleteAll() throws SQLException {
    Connection c = null;
    PreparedStatement ps = null;
    
    try {
	    c = dataSource.getConnection();
			ps = c.prepareStatement("delete from users");
			ps.executeUpdate();
	  } catch (SQLException e) {
	    throw e;
	  } finally {
	    if (ps != null) { // psê°€ nullì´ë©´, NPE ë°œìƒí•˜ê¸° ë•Œë¬¸
	      try {
	        ps.close();
	      } catch (SQLException e) {
	      }
	    }
	    if (c != null) {
	      try { 
	        c.close();
	      } catch (SQLException e) {
	      }
	    }
}
```

- Try
    - ì˜ˆì™¸ê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìˆëŠ” ì½”ë“œë¥¼ ëª¨ë‘ try ë¸”ë¡ì— ë¬¶ì–´ì¤€ë‹¤.
- Catch
    - ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œ ë¶€ê°€ì ì¸ ì‘ì—…ì„ í•  ìˆ˜ ìˆë„ë¡ catch ë¸”ë¡ì„ ë‘”ë‹¤.
- Finally
    - Try ë¸”ë¡ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë“  ì•ˆí•˜ë“  ë°˜ë“œì‹œ ì‹¤í–‰ëœë‹¤.

---

## JDBC ì¡°íšŒ ê¸°ëŠ¥ì˜ ì˜ˆì™¸ì²˜ë¦¬

ì¡°íšŒë¥¼ ìœ„í•œ JDBC ì½”ë“œëŠ” ì¢€ ë” ë³µì¡í•˜ë‹¤.

Connection, PreparedStatement ì´ì™¸ `ResultSet`ì´ ì¶”ê°€ë˜ê¸° ë•Œë¬¸ì´ë‹¤.

`ResultSet`ë„ ë°˜í™˜ì´ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë¼ì„œ `close`() ë©”ì†Œë“œë¥¼ ë°˜ë“œì‹œ í˜¸ì¶œí•´ì•¼í•œë‹¤.

```java
public int getCount() throws SQLException {
    Connection c = null;
    PreparedStatement ps = null;
    ResultSet rs = null;
    
    try { 
        ...
        
        rs = ps.executeQuery();
        rs.next();
        return rs.getInt(1);
    } catch (SQLException e) {
		    throw e;
	  } finally {
	      if (rs != null) {
	          try {
			          rs.close();
			      } catch (SQLException e) {
					  }
		    ...
```


> âš ï¸
>
> close()ëŠ” ìƒì„± ìˆœì„œì™€ ì—­ìˆœìœ¼ë¡œ ìˆ˜í–‰ë˜ì–´ì•¼ í•œë‹¤.
> 
> â†’ `PreparedStatement`ê°€ ë‹«íˆê¸° ì „ì— `Connection`ì´ ë‹«íˆë©´, `PreparedStatement`ê°€ ì‚¬ìš©í•˜ëŠ” ë¦¬ì†ŒìŠ¤ê°€ ë” ì´ìƒ ìœ íš¨í•˜ì§€ ì•Šê²Œ ë˜ì–´ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ

---

# ë³€í•˜ëŠ” ê²ƒê³¼ ë³€í•˜ì§€ ì•ŠëŠ” ê²ƒ

---

## JDBC try/catch/finally ì½”ë“œì˜ ë¬¸ì œì 

try/catch/finally ë¸”ë¡ì´ 2ì¤‘ìœ¼ë¡œ ì¤‘ì²©ë˜ì–´ ë‚˜ì˜¤ëŠ”ë°ë‹¤ ëª¨ë“  ë©”ì†Œë“œë§ˆë‹¤ ë°˜ë³µë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

â†’ ì´ ë¬¸ì œì˜ í•µì‹¬ì€ ë³€í•˜ì§€ ì•ŠëŠ”, ê·¸ëŸ¬ë‚˜ ë§ì€ ê³³ì—ì„œ ì¤‘ë³µë˜ëŠ” ì½”ë“œì™€ ë¡œì§ì— ë”°ë¼ ìê¾¸ í™•ì¥ë˜ê³  ìì£¼ ë³€í•˜ëŠ” ì½”ë“œë¥¼ ì˜ ë¶„ë¦¬í•´ë‚´ì–´ì•¼ í•œë‹¤.

## ë¶„ë¦¬ì™€ ì¬ì‚¬ìš©ì„ ìœ„í•œ ë””ìì¸ íŒ¨í„´ ì ìš©

```java
Connection c = null;
PreparedStatement ps = null;

try {
	    c = dataSource.getConnection();
	    // ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ (ìƒìœ„)
	    
			// ë³€í•˜ëŠ” ë¶€ë¶„
			ps = c.prepareStatement("delete from users");
			
			// ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ (í•˜ìœ„)
			ps.executeUpdate();
	  } catch (SQLException e) {
	    throw e;
	  } finally {
	    if (ps != null) { // psê°€ nullì´ë©´, NPE ë°œìƒí•˜ê¸° ë•Œë¬¸
	      try {
	        ps.close();
	      } catch (SQLException e) {
	      }
	    }
	    if (c != null) {
	      try { 
	        c.close();
	      } catch (SQLException e) {
	      }
	    }
```

### ë©”ì†Œë“œ ì¶”ì¶œ

ë³€í•˜ëŠ” ë¶€ë¶„ì„ `ë©”ì†Œë“œ`ë¡œ ë¹¼ëŠ” ë°©ë²•ì´ ìˆë‹¤.

```java
public void deleteAll() throws SQLException {
    ...
    
    try {
	    c = dataSource.getConnection();
			
			ps = makeStatement(c);
			
			ps.executeUpdate();
	  } catch (SQLException e) {
	    ...
}

private PreparedStatement makeStatement(Connection c) throws SQLException {
		PreparedStatement ps;
		ps = c.prepareStatement("delete from users");
		return ps;
}
```

â†’ í•˜ì§€ë§Œ `makeStatement()`ëŠ” ë³„ ì´ë“ì´ ì—†ì–´ ë³´ì¸ë‹¤.

1. ë‹¤ë¥¸ ê³³ì— ì¬ì‚¬ìš© ë¶ˆê°€
2. ë¶„ë¦¬ëœ ë©”ì†Œë“œëŠ” DAO ë¡œì§ë§ˆë‹¤ ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ì„œ í™•ì¥ë¼ì•¼ í•˜ëŠ”ë° ê·¸ë ‡ì§€ ì•ŠìŒ.

### í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´ì˜ ì ìš©

> **í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´**
>

ìƒì†ì„ í†µí•´ ê¸°ëŠ¥ì„ í™•ì¥í•´ì„œ ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.

ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì€ `ìŠˆí¼í´ë˜ìŠ¤`ì— ë‘ê³  ë³€í•˜ëŠ” ë¶€ë¶„ì€ `ì¶”ìƒ ë©”ì†Œë“œ`ë¡œ ì •ì˜í•´ë‘¬ì„œ ì„œë¸Œí´ë˜ìŠ¤ì—ì„œ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ ìƒˆë¡­ê²Œ ì •ì˜í•˜ë„ë¡ í•œë‹¤.

```java
public class UserDaoDeleteAll extends UserDao {
		protected PreparedStatement makeStatement(Connection c) throws SQLException {
				PreparedStatement ps;
				ps = c.prepareStatement("delete from users");
				return ps;
    }
}
```

â†’ ì´ì œ UserDao í´ë˜ìŠ¤ì˜ ê¸°ëŠ¥ì„ í™•ì¥í•˜ê³  ì‹¶ì„ ë•Œë§ˆë‹¤ ìƒì†ì„ í†µí•´ ììœ ë¡­ê²Œ í™•ì¥í•  ìˆ˜ ìˆë‹¤.

But. DAO ë¡œì§ë§ˆë‹¤ ìƒì†ì„ í†µí•´ ìƒˆë¡œìš´ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤.

But. í™•ì¥ êµ¬ì¡°ê°€ ì´ë¯¸ í´ë˜ìŠ¤ë¥¼ ì„¤ê³„í•˜ëŠ” ì‹œì ì—ì„œ ê³ ì •ëœë‹¤. (ìœ ì—°ì„±ì´ ë–¨ì–´ì§)

### ì „ëµ íŒ¨í„´ì˜ ì ìš©

> **ì „ëµ íŒ¨í„´**
>

ê°œë°© íì‡„ ì›ì¹™ì„ ì˜ ì§€í‚¤ëŠ” êµ¬ì¡°ì´ë©´ì„œë„ í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´ë³´ë‹¤ ìœ ì—°í•˜ê³  í™•ì¥ì„±ì´ ë›°ì–´ë‚œ ê²ƒì´,

ì˜¤ë¸Œì íŠ¸ë¥¼ ì•„ì˜ˆ ë‘˜ë¡œ ë¶„ë¦¬í•˜ê³  í´ë˜ìŠ¤ ë ˆë²¨ì—ì„œëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ì„œë§Œ ì˜ì¡´í•˜ë„ë¡ í•˜ëŠ” ê²ƒ

â†’ í™•ì¥ì— í•´ë‹¹í•˜ëŠ” `ë³€í•˜ëŠ” ë¶€ë¶„`ì„ ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ ì¶”ìƒí™”ëœ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ìœ„ì„í•˜ëŠ” ë°©ì‹

![images](https://github.com/user-attachments/assets/953e0c26-2353-40ff-a4cf-b3123df8a3ee)

- **Context =** ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„
- **Strategy** = ë³€í•˜ëŠ” ë¶€ë¶„

- `deleteAll`()ì˜ **Context**
    - DB ì»¤ë„¥ì…˜ ê°€ì ¸ì˜¤ê¸°
    - PreparedStatementë¥¼ ë§Œë“¤ì–´ì¤„ ì™¸ë¶€ ê¸°ëŠ¥ í˜¸ì¶œí•˜ê¸°
    - ì „ë‹¬ë°›ì€ PreparedStatement ì‹¤í–‰í•˜ê¸°
    - ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì´ë¥¼ ë‹¤ì‹œ ë©”ì†Œë“œ ë°–ìœ¼ë¡œ ë˜ì§€ê¸°
    - ëª¨ë“  ê²½ìš°ì— ë§Œë“¤ì–´ì§„ PreparedStatementì™€ Connectionì„ ì ì ˆíˆ ë‹«ì•„ì£¼ê¸°

- `deleteAll`()ì˜ **Strategy**
    - PreparedStatement ìƒì„± ì „ëµ í˜¸ì¶œ

`ì „ëµ ì¸í„°í˜ì´ìŠ¤`

```java
public interface StatementStrategy {
		PreparedStatement makePreparedStatement(Connection c) throws SQLException;
}
```

`êµ¬í˜„í•œ ì „ëµ í´ë˜ìŠ¤`

```java
public class DeleteAllStatement implements StatementStrategy {
		public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
						PreparedStatement ps = c.prepareStatement("delete from users");
						return ps;
		}
}
```

`ì ìš©í•œ deleteAll() ë©”ì†Œë“œ`

```java
public void deleteAll() throws SQLException {
    ...
    
    try {
	    c = dataSource.getConnection();
			
			StatementStrategy strategy = new DeleteAllStatement();
			ps = strategy.makePreparedStatement(c);
			
			ps.executeUpdate();
	  } catch (SQLException e) {
	    ...
}
```

â†’ ì „ëµ íŒ¨í„´ì€ ì»¨í…ìŠ¤íŠ¸ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë˜ë©´ì„œ ì „ëµì„ ë°”ê¿”ì“¸ ìˆ˜ ìˆë‹¤.

But. ì»¨í…ìŠ¤íŠ¸ ì•ˆì—ì„œ DeleteAllStatementë¥¼ ì‚¬ìš©í•˜ë„ë¡ ê³ ì •ë˜ì–´ ìˆë‹¤.

### DI ì ìš©ì„ ìœ„í•œ í´ë¼ì´ì–¸íŠ¸/ì»¨í…ìŠ¤íŠ¸ ë¶„ë¦¬

ì „ëµ íŒ¨í„´ì— ë”°ë¥´ë©´ Contextê°€ ì–´ë–¤ ì „ëµì„ ì‚¬ìš©í•˜ê²Œ í•  ê²ƒì¸ê°€ëŠ” ì•ë‹¨ì˜ Clientê°€ ê²°ì •í•˜ëŠ”ê²Œ ì¼ë°˜ì ì´ë‹¤. Clientê°€ êµ¬ì²´ì ì¸ ì „ëµì˜ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ê³  ì˜¤ë¸Œì íŠ¸ë¡œ ë§Œë“¤ì–´ì„œ Contextì— ì „ë‹¬í•œë‹¤.

`ì»¨í…ìŠ¤íŠ¸ë¥¼ ë©”ì†Œë“œë¡œ ë¶„ë¦¬í•œ ì½”ë“œ`

```java
public void jdbcContextWithStatementStrategy(StatementStrategy stmt) throws SQLException {
		Conncetion c = null;
		PreparedStatement ps = null;
		
		try {
	    c = dataSource.getConnection();
			
			ps = stmt.makePreparedStatement(c);
			
			ps.executeUpdate();
	  } catch (SQLException e) {
```

- í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° StatementStrategy íƒ€ì…ì˜ ì „ëµ ì˜¤ë¸Œì íŠ¸ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì œê³µë°›ëŠ”ë‹¤.
- ì œê³µë°›ì€ ì „ëµ ì˜¤ë¸Œì íŠ¸ëŠ” PreparedStatement ìƒì„±ì´ í•„ìš”í•œ ì‹œì ì— í˜¸ì¶œí•´ì„œ ì‚¬ìš©í•œë‹¤.

`í´ë¼ì´ì–¸íŠ¸ ì±…ì„ì„ ë‹´ë‹¹í•œ deleteAll() ë©”ì†Œë“œ`

```java
public void deleteAll() throws SQLException {
    // ì„ ì •í•œ ì „ëµ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ ìƒì„±
		StatementStrategy st = new DeleteAllStatement();
		
		// ì»¨í…ìŠ¤íŠ¸ í˜¸ì¶œ, ì „ëµ ì˜¤ë¸Œì íŠ¸ ì „ë‹¬
		jdbcContextWithStatementStrategy(st);
}		
```

---

# JDBC ì „ëµ íŒ¨í„´ì˜ ìµœì í™”

---

## ì „ëµê³¼ í´ë¼ì´ì–¸íŠ¸ì˜ ë™ê±°

`ë¬¸ì œì `

1. í˜„ì¬ DAO ë©”ì†Œë“œë§ˆë‹¤ ìƒˆë¡œìš´ StatementStrategy êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤. â†’ í´ë˜ìŠ¤ íŒŒì¼ì˜ ê°œìˆ˜ê°€ ëŠ˜ì–´ë‚œë‹¤.
2. DAO ë©”ì†Œë“œì—ì„œ StatementStrategyì— ë¶€ê°€ì ì¸ ì •ë³´ê°€ í•„ìš”í•  ê²½ìš°, ì´ë¥¼ ìœ„í•´ ì˜¤ë¸Œì íŠ¸ë¥¼ ì „ë‹¬ë°›ëŠ” `ìƒì„±ì`ì™€ ì´ë¥¼ ì €ì¥í•´ë‘˜ `ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜`ë¥¼ ë²ˆê±°ë¡­ê²Œ ë§Œë“¤ì–´ì•¼ í•œë‹¤.

### í•´ê²° 1. ë¡œì»¬ í´ë˜ìŠ¤

StatementStrategy ì „ëµ í´ë˜ìŠ¤ë¥¼ ë§¤ë²ˆ ë…ë¦½ëœ íŒŒì¼ì´ ì•„ë‹Œ UserDao í´ë˜ìŠ¤ ì•ˆì— ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ì •ì˜í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤. DeleteAllStatementë‚˜ AddStatementëŠ” UserDao ë°–ì—ì„œ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤. â†’ UserDaoì™€ ê°•í•˜ê²Œ ê²°í•©

`ë¡œì»¬ í´ë˜ìŠ¤`

```java
public void add(User user) throws SQLException {
	class AddStatement implements Statementstrategy {
			User user;
			
			public AddStatement(User user) {
					this.user = user;
			}
			
			public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
			
			PreparedStatement ps =
					c.prepareStatement("insert into users(id, name, password)
															values(?,?,?)");
			ps.setString(1, user.getId);
			ps.setString(2, user.getName);
			ps.setString(3, user.getPassword);
			
			return ps;
			}
	}
	Statementstrategy st = new AddStatement(user);
	jdbcContextWithStatementStrategy(st);
```

AddStatement í´ë˜ìŠ¤ë¥¼ ë¡œì»¬ í´ë˜ìŠ¤ë¡œì¨ add() ë©”ì†Œë“œ ì•ˆì— ì§‘ì–´ ë„£ì€ ê²ƒì´ë‹¤.

**ì¥ì **

1. ë¡œì»¬ í´ë˜ìŠ¤ëŠ” ì„ ì–¸ëœ ë©”ì†Œë“œ ë‚´ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
2. ë¡œì»¬ í´ë˜ìŠ¤ëŠ” í´ë˜ìŠ¤ê°€ ë‚´ë¶€ í´ë˜ìŠ¤ì´ê¸° ë•Œë¬¸ì— ìì‹ ì´ ì„ ì–¸ëœ ê³³ì˜ ì •ë³´ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤. â†’ íŒŒë¼ë¯¸í„°ë¡œ ë“¤ì–´ì˜¨ Userì— ê·¸ëŒ€ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

`ì¥ì  2ë¥¼ ì ìš©í•œ ì½”ë“œ` - íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë°›ì€ Userë¥¼ ì‚¬ìš©í•´ ìƒì„±ìì™€ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ ì œê±°

```java
public void add(final User user) throws SQLException {
	class AddStatement implements Statementstrategy {
			public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
			
			PreparedStatement ps =
					c.prepareStatement("insert into users(id, name, password)
															values(?,?,?)");
			ps.setString(1, user.getId);
			ps.setString(2, user.getName);
			ps.setString(3, user.getPassword);
			
			return ps;
			}
	}
	Statementstrategy st = new AddStatement();
	jdbcContextWithStatementStrategy(st);
```

### í•´ê²° 2. ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤

í´ë˜ìŠ¤ ì´ë¦„ì„ ì œê±°í•  ìˆ˜ ìˆëŠ” ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

> **ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤**
>

`new ì¸í„°í˜ì´ìŠ¤ ì´ë¦„() { í´ë˜ìŠ¤ ë³¸ë¬¸ };`

- ì„ ì–¸ê³¼ ë™ì‹œì— ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•œë‹¤.
- í´ë˜ìŠ¤ ìì‹ ì˜ íƒ€ì…ì„ ê°€ì§ˆ ìˆ˜ ì—†ë‹¤.
- êµ¬í˜„í•œ ì¸í„°í˜ì´ìŠ¤ íƒ€ì…ì˜ ë³€ìˆ˜ì—ë§Œ ì €ì¥í•  ìˆ˜ ìˆë‹¤.

`ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ ì „í™˜`

```java
StatementStrategy st = new StatementStrategy() {
		public PreparedStatement makePreparedStatement(Connection c)
		throws SQLException {
				PreparedStatement ps =
					c.prepareStatement("insert into users(id, name, password)
						values(?,?,?)");
				ps.setString(1, user.getld();
				ps.setString(2, user.getName();
				ps.setString(3, user.getPassword();
				return ps;
		}
};
```

â†’ ë§Œë“¤ì–´ì§„ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ëŠ” ë”± í•œ ë²ˆë§Œ ì‚¬ìš©í•˜ë‹ˆ ë©”ì†Œë“œì˜ íŒŒë¼ë¯¸í„°ì—ì„œ ë°”ë¡œ ìƒì„±í•˜ëŠ” ê²Œ ë‚«ë‹¤.

`ë©”ì†Œë“œ íŒŒë¼ë¯¸í„°ë¡œ ì´ì „í•œ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ ì ìš©`

```java
public void add(final User user) throws SQLException {
		jdbcContextWithStatementStrategy(
				new StatementStrategy() {
						public PreparedStatement makePreparedStatement(Connection c)
						throws SQLException {
								PreparedStatement ps =
									c.prepareStatement("insert into users(id, name, password)
										values(?,?,?)");
								ps.setString(1, user.getld();
								ps.setString(2, user.getName();
								ps.setString(3, user.getPassword();
								return ps;
						}
				}
	  };
}
```

`ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ ì ìš©í•œ deleteAll() ë©”ì†Œë“œ`

```java
public void deleteAll() throws SQLException {
		jdbcContextWithStatementStrategy(
				new StatementStrategy() {
						public PreparedStatement makePreparedStatement(Connection c)
										throws SQLException {
								return c.prepareStatement("delete from users");
						}
				}
	  };
}
```

---

# ì»¨í…ìŠ¤íŠ¸ì™€ DI

## JdbcContextì˜ ë¶„ë¦¬

- UserDaoì˜ ë©”ì†Œë“œ = í´ë¼ì´ì–¸íŠ¸
- ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ = ê°œë³„ì ì¸ ì „ëµ
- jdbcContextWithStatementStrategy() = ì»¨í…ìŠ¤íŠ¸

`jdbcContextWithStatementStrategy()` ëŠ” JDBCì˜ ì¼ë°˜ì ì¸ ì‘ì—… íë¦„ì„ ë‹´ê³  ìˆì–´ ë‹¤ë¥¸ DAOì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

### í´ë˜ìŠ¤ ë¶„ë¦¬

ë¶„ë¦¬í•´ì„œ ë§Œë“¤ í´ë˜ìŠ¤ = `JdbcContext`

`JdbcContext`

```java
public class JdbcContext {
		private DataSource dataSource;
		
		// ìˆ˜ì •ì DI
		public void setDataSource(DataSource dataSource) {
				this.dataSource = dataSource;
		}
		
		public void workWithStatementStrategy(Statementstrategy stmt) throws
		SQLException {
				Connection c = null;
				PreparedStatement ps = null;

				try {
						c = this.dataSource.getConnection();
						ps = stmt.makePreparedStatement(c);
						ps.executepUdate();
				} catch (SQLException e) {
						throw e;
				} ...
```

`UserDao`

```java
public class UserDao {
		
		private JdbcContext jdbcContext;
		
		public void setJdbcContext(JdbcContext jdbcContext) {
				this.jdbcContext = jdbcContext;
		}
		
		public void add(final User user) throws SQLException {
				this.jdbcContext.workWithStatementStrategy(
						new StatementStrategy() { ... }
				);
		}
		...
```

### ë¹ˆ ì˜ì¡´ê´€ê³„ ë³€ê²½

ìœ„ì˜ `UserDao`ì™€ `JdbcContext`ë¥¼ ìŠ¤í”„ë§ ì„¤ì •ì— ì ìš©í•´ë³´ì.

> ğŸ’¡
>
> ìŠ¤í”„ë§ì˜ DIëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ì´ì— ë‘ê³  ì˜ì¡´ í´ë˜ìŠ¤ë¥¼ ë°”ê¿”ì„œ ì‚¬ìš©**í•˜ë„ë¡ í•˜ëŠ” ê²Œ ëª©ì ì´ë‹¤.
>
> í•˜ì§€ë§Œ JdbcContextëŠ” ê·¸ ìì²´ë¡œ ë…ë¦½ì ì¸ JDBC ì»¨í…ìŠ¤íŠ¸ë¥¼ ì œê³µí•´ì£¼ëŠ” ì„œë¹„ìŠ¤ ì˜¤ë¸Œì íŠ¸ë¡œì¨ ì˜ë¯¸ê°€ ìˆì„ ë¿ì´ê³  êµ¬í˜„ ë°©ë²•ì´ ë°”ë€” ê°€ëŠ¥ì„±ì€ ì—†ë‹¤.
>
> â†’ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë„ë¡ ë§Œë“¤ì§€ ì•Šê³ , DIë¥¼ ì ìš©í•˜ëŠ” êµ¬ì¡°ë„ ì¡´ì¬í•œë‹¤.


## JdbcContextì˜ íŠ¹ë³„í•œ DI

UserDaoëŠ” ê¸°ì¡´ê³¼ ë‹¬ë¦¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ì½”ë“œì—ì„œ ë°”ë¡œ JdbcContext í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤. â† UserDaoì™€ JdbcContextëŠ” `í´ë˜ìŠ¤` ë ˆë²¨ì—ì„œ ì˜ì¡´ê´€ê³„ê°€ ê²°ì •ëœë‹¤.

ì´ ê²½ìš°, ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ì˜ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•  ìˆ˜ëŠ” ì—†ë‹¤.

### 1. ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ DI

Q. ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  DIë¥¼ ì ìš©í•˜ëŠ” ê²ƒì€ ë¬¸ì œê°€ ìˆì„ê¹Œ?

A. ê¼­ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê±°ì³ì„œ DIë¥¼ í•  í•„ìš”ëŠ” ì—†ë‹¤.

> **ì˜ì¡´ê´€ê³„ ì£¼ì…(DI)ì˜ ê°œë…**
>
- ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ì´ì— ë‘¬ì„œ í´ë˜ìŠ¤ ë ˆë²¨ì—ì„œ ì˜ì¡´ê´€ê³„ê°€ ê³ ì •ë˜ì§€ ì•Šê²Œ í•œë‹¤.
- ëŸ°íƒ€ì„ ì‹œì— ì˜ì¡´í•  ì˜¤ë¸Œì íŠ¸ì™€ì˜ ê´€ê³„ë¥¼ ë™ì ìœ¼ë¡œ ì£¼ì…í•´ì£¼ëŠ” ê²ƒì´ ë§ë‹¤.

â†’ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë‹¤ë©´, ì—„ë°€íˆ ë§í•´ ì˜¨ì „í•œ DIë¼ í•  ìˆœ ì—†ë‹¤.

But. ìŠ¤í”„ë§ì˜ DIëŠ” ê°ì²´ì˜ ìƒì„±ê³¼ ê´€ê³„ì„¤ì •ì— ëŒ€í•œ ì œì–´ ê¶Œí•œì„ ì˜¤ë¸Œì íŠ¸ì—ì„œ ì œê±°í•˜ê³ , ì™¸ë¶€ë¡œ ìœ„ì„í–ˆë‹¤ëŠ” IoC ê°œë…ì„ í¬ê´„í•œë‹¤.

â†’ ê·¸ëŸ° ì˜ë¯¸ì—ì„œ í´ë˜ìŠ¤ ë ˆë²¨ì˜ DIë¼ í•  ì§€ë¼ë„, DIì˜ ê¸°ë³¸ì„ ë”°ë¥´ê³  ìˆë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.

> `JdbcContext`, `UserDao`ë¥¼ DI êµ¬ì¡°ë¡œ ë§Œë“¤ì–´ì•¼ í•˜ëŠ” ì´ìœ 
>
1. JdbcContextê°€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ê´€ë¦¬ë˜ëŠ” ì‹±ê¸€í†¤ ë¹ˆì´ ë˜ê¸° ë•Œë¬¸ì´ë‹¤.
    - JdbcContextëŠ” ìƒíƒœ ì •ë³´ë¥¼ ê°–ê³  ìˆì§€ ì•Šë‹¤.
        - dataSourceëŠ” ì½ê¸° ì „ìš©
    - Jdbc ì»¨í…ìŠ¤íŠ¸ ë©”ì†Œë“œë¥¼ ì œê³µí•´ì£¼ëŠ” ì¼ì¢…ì˜ ì„œë¹„ìŠ¤ ì˜¤ë¸Œì íŠ¸ë¡œì„œ ì˜ë¯¸ê°€ ìˆë‹¤.

   â†’ ì‹±ê¸€í†¤ìœ¼ë¡œ ë“±ë¡ë¼ì„œ ì—¬ëŸ¬ ì˜¤ë¸Œì íŠ¸ì—ì„œ ê³µìœ í•´ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì´ìƒì ì´ë‹¤.

2. JdbcContextê°€ DIë¥¼ í†µí•´ ë‹¤ë¥¸ ë¹ˆì— ì˜ì¡´í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
    - JdbcContextëŠ” dataSource í”„ë¡œí¼í‹°ë¥¼ í†µí•´ DataSource ì˜¤ë¸Œì íŠ¸ë¥¼ ì£¼ì…ë°›ëŠ”ë‹¤.
        - DIë¥¼ ìœ„í•´ì„  ì£¼ì…ë˜ëŠ” ì˜¤ë¸Œì íŠ¸ì™€ ì£¼ì…ë°›ëŠ” ì˜¤ë¸Œì íŠ¸ ì–‘ìª½ ëª¨ë‘ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ë¼ì•¼ í•œë‹¤.
            - ìŠ¤í”„ë§ì´ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ëŠ” IoC ëŒ€ìƒì´ì–´ì•¼ DIì— ì°¸ì—¬í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

>â“
>
> ê·¸ë˜ì„œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ì´ìœ ê°€ ë­”ë°?
>
> â†’ ì¸í„°í˜ì´ìŠ¤ê°€ ì—†ë‹¤ëŠ” ê±´ UserDaoì™€ JdbcContextê°€ ë§¤ìš° ê¸´ë°€í•œ ê´€ê³„ë¥¼ ê°€ì§€ê³  ê°•ê²°í•© ë˜ì–´ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.
>
> â†’ ë§Œì•½ JDBC ë°©ì‹ì´ ì•„ë‹Œ JPAë‚˜ í•˜ì´ë²„ë„¤ì´íŠ¸ ê°™ì€ ORMì„ ì‚¬ìš©í•œë‹¤ë©´ JdbcContextë¥¼ í†µì§¸ë¡œ ë°”ê¿”ì•¼ í•œë‹¤. ì¦‰ ë‹¤ë¥¸ êµ¬í˜„ìœ¼ë¡œ ëŒ€ì²´í•´ì„œ ì‚¬ìš©í•  ì´ìœ ê°€ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.


### 2. ì½”ë“œë¥¼ ì´ìš©í•˜ëŠ” ìˆ˜ë™ DI

JdbcContextë¥¼ ìŠ¤í”„ë§ì˜ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì„œ DIí•˜ëŠ” ëŒ€ì‹ , UserDao ë‚´ë¶€ì—ì„œ ì§ì ‘ DIë¥¼ ì ìš©í•˜ëŠ” ë°©ë²•ì´ë‹¤.

ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´, `1. ì‹±ê¸€í†¤ ë§Œë“œëŠ” ê²ƒì„ í¬ê¸°`í•´ì•¼í•œë‹¤.

ë‹¤ë§Œ, ì‹±ê¸€í†¤ì„ í¬ê¸°í•˜ë”ë¼ë„ DAO ë©”ì†Œë“œê°€ í˜¸ì¶œë  ë•Œë§ˆë‹¤ JdbcContextë¥¼ ìƒˆë¡œ ë§Œë“œëŠ” ê²ƒì´ ì•„ë‹Œ, DAOë§ˆë‹¤ í•˜ë‚˜ì˜ JdbcContextì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ê°–ê²Œ í•˜ë©´ ëœë‹¤. (`ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜`)

ë˜í•œ JdbcContextë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ëˆ„êµ°ê°€ JdbcContextë¥¼ ì œì–´í•´ì•¼ í•œë‹¤. ì´ê±´ UserDaoê°€ JdbcContextì˜ ì œì–´ê¶Œì„ ê°€ì§€ë©´ ëœë‹¤. (`IoC`)

`2. JdbcContextê°€ DIë¥¼ í†µí•´ ë‹¤ë¥¸ ë¹ˆì— ì˜ì¡´` í•˜ëŠ” ê²½ìš°ì—ëŠ” JdbcContextì—ì„œ DIë¥¼ í†µí•´ ì œê³µë°›ì§€ ì•Šê³ , UserDaoì—ì„œ `DI`ê¹Œì§€ ë§¡ê¸°ë©´ í•´ê²°ëœë‹¤. DIì‹œ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ë¥¼ UserDaoì—ì„œ ì£¼ì…í•´ì£¼ë©´ ëœë‹¤.

`JdbcContext ìƒì„± ë° DI ì‘ì—… ìˆ˜í–‰í•˜ëŠ” ë©”ì†Œë“œ`

```java
public class UserDao {
		...
		
		private JdbcContext jdbcContext;
		
		public void setDataSource(DataSource dataSource) {
		    this.jdbcContext = new JdbcContext(); // JdbcContext ìƒì„±
		    this.jdbcContext.setDataSource(dataSource); // DI
		    ..
		}
```

### 1, 2ë²ˆ ì¥ë‹¨ì 

> 1. ìŠ¤í”„ë§ DI ì¥ë‹¨ì 
>
- ì¥ì 
    - ì‹¤ì œ ì˜ì¡´ ê´€ê³„ê°€ ì„¤ì •íŒŒì¼(xml)ì— ëª…í™•í•˜ê²Œ ë“œëŸ¬ë‚¨.
- ë‹¨ì 
    - DIì˜ ê·¼ë³¸ì ì¸ ì›ì¹™ì— ë¶€í•©í•˜ì§€ ì•ŠëŠ” êµ¬ì²´ì ì¸ í´ë˜ìŠ¤ì™€ì˜ ê´€ê³„ê°€ ì§ì ‘ ë…¸ì¶œë¨.

> 2. ìˆ˜ë™ DI ì¥ë‹¨ì 
>
- ì¥ì 
    - JdbcContextê°€ UserDao ë‚´ë¶€ì—ì„œ ë§Œë“¤ì–´ì§€ê³  ì‚¬ìš©ë˜ë©´ì„œ ê´€ê³„ë¥¼ ì™¸ë¶€ì— ë“œëŸ¬ë‚´ì§€ ì•ŠìŒ.
- ë‹¨ì 
    - ì‹±ê¸€í†¤ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ì—†ìŒ.
    - DI ì‘ì—…ì„ ìœ„í•œ ë¶€ê°€ì ì¸ ì½”ë“œê°€ í•„ìš”.

---

# í…œí”Œë¦¿ê³¼ ì½œë°±

---

**í…œí”Œë¦¿** = ì „ëµ íŒ¨í„´ì˜ ì»¨í…ìŠ¤íŠ¸

â†’ ê³ ì •ëœ ì‘ì—… íë¦„ì„ ê°€ì§„ ì½”ë“œë¥¼ ì¬ì‚¬ìš©

**ì½œë°±** = ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ì§€ëŠ” ì˜¤ë¸Œì íŠ¸

â†’ í…œí”Œë¦¿ ì•ˆì—ì„œ í˜¸ì¶œë˜ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ì˜¤ë¸Œì íŠ¸

## í…œí”Œë¦¿/ì½œë°± ë™ì‘ì›ë¦¬

### í…œí”Œë¦¿/ì½œë°± íŠ¹ì§•

- í…œí”Œë¦¿/ì½œë°± íŒ¨í„´ì˜ ì½œë°±ì€ ë³´í†µ ë‹¨ì¼ ë©”ì†Œë“œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤.
    - í…œí”Œë¦¿ì˜ ì‘ì—… íë¦„ ì¤‘ íŠ¹ì • ê¸°ëŠ¥ì„ ìœ„í•´ í•œ ë²ˆ í˜¸ì¶œë˜ëŠ” ê²½ìš°ê°€ ì¼ë°˜ì ì´ê¸° ë•Œë¬¸ì´ë‹¤.
- í•˜ë‚˜ì˜ í…œí”Œë¦¿ì—ì„œ ì—¬ëŸ¬ ê°€ì§€ ì¢…ë¥˜ì˜ ì „ëµì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´ í•˜ë‚˜ ì´ìƒì˜ ì½œë°± ì˜¤ë¸Œì íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
    - ì½œë°±ì€ ì¼ë°˜ì ìœ¼ë¡œ í•˜ë‚˜ì˜ ë©”ì†Œë“œë¥¼ ê°€ì§„ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ì§„ë‹¤ê³  ë³´ë©´ ëœë‹¤.
- ì½œë°± ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì†Œë“œì—ëŠ” ë³´í†µ íŒŒë¼ë¯¸í„°ê°€ ìˆë‹¤. ì´ íŒŒë¼ë¯¸í„°ëŠ” ì»¨í…ìŠ¤íŠ¸ ì •ë³´ë¥¼ ë°›ì„ ë•Œ ì‚¬ìš©ëœë‹¤.

![í…œí”Œë¦¿/ì½œë°±ì˜ ì‘ì—… íë¦„](https://github.com/user-attachments/assets/03863bff-936e-4cee-9137-ecd63f0501e7)

í…œí”Œë¦¿/ì½œë°±ì˜ ì‘ì—… íë¦„

- í´ë¼ì´ì–¸íŠ¸ê°€ í…œí”Œë¦¿ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ì„œ ì½œë°± ì˜¤ë¸Œì íŠ¸ë¥¼ ì „ë‹¬í•˜ëŠ” ê²ƒì€ ë©”ì†Œë“œ ë ˆë²¨ì—ì„œ ì¼ì–´ë‚˜ëŠ” DIë‹¤.
- ë§¤ë²ˆ ë©”ì†Œë“œ ë‹¨ìœ„ë¡œ ì‚¬ìš©í•  ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒˆë¡­ê²Œ ì „ë‹¬ë°›ëŠ”ë‹¤.
- ì½œë°± ì˜¤ë¸Œì íŠ¸ê°€ ë‚´ë¶€ í´ë˜ìŠ¤ë¡œì¨ ìì‹ ì„ ìƒì„±í•œ í´ë¼ì´ì–¸íŠ¸ ë©”ì†Œë“œ ë‚´ì˜ ì •ë³´ë¥¼ ì§ì ‘ ì°¸ì¡°í•œë‹¤.

![JdbcContextì— ì ìš©ëœ í…œí”Œë¦¿/ì½œë°±](https://github.com/user-attachments/assets/0ad3e5c1-b664-4135-9090-73fbfa2426da)

JdbcContextì— ì ìš©ëœ í…œí”Œë¦¿/ì½œë°±

## í¸ë¦¬í•œ ì½œë°±ì˜ ì¬í™œìš©

### ì½œë°±ì˜ ë¶„ë¦¬ì™€ ì¬í™œìš©

ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ìƒëŒ€ì ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì½ê¸°ê°€ ì¢€ ë¶ˆí¸í•˜ë‹¤.

ë§Œì•½ ë¶„ë¦¬ë¥¼ í†µí•´ ì¬ì‚¬ìš©ì´ ê°€ëŠ¥í•œ ì½”ë“œë¥¼ ì°¾ì•„ë‚¼ ìˆ˜ ìˆë‹¤ë©´ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•œ ì½”ë“œë¥¼ ê°„ê²°í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

```java
public void deleteAll() throws SQLException {
		workWithStatementStrategy(
				new StatementStrategy() {
						public PreparedStatement makePreparedStatement(Connection c)
										throws SQLException {
								return c.prepareStatement("delete from users");
						}
				}
	  };
}
```

- ë³€í•˜ëŠ” ê²ƒ : ì¿¼ë¦¬ë¬¸
- ë³€í•˜ì§€ ì•ŠëŠ” ê²ƒ : new StatementStrategy() ìƒì„± ê³¼ì •

ë³€í•˜ëŠ” ê²ƒì€ ì˜¤ë¡œì§€ ì¿¼ë¦¬ë¬¸ì´ê¸° ë•Œë¬¸ì— ì¿¼ë¦¬ë¬¸ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìœ¼ë©´ í•´ê²°ëœë‹¤.

```java
public void deleteAll() throws SQLException {
		executeSql("delete from users"); // ë³€í•˜ëŠ” ê²ƒ
}

// ë³€í•˜ì§€ ì•ŠëŠ” ê²ƒ
public void executeSql(final String query) throws SQLException {
		workWithStatementStrategy(
				new StatementStrategy() {
						public PreparedStatement makePreparedStatement(Connection c)
										throws SQLException {
								return c.prepareStatement(query);
						}
				}
	  };
}
```

### ì½œë°±ê³¼ í…œí”Œë¦¿ì˜ ê²°í•©

executeSql() ë©”ì†Œë“œëŠ” ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì½œë°±ì´ë¯€ë¡œ UserDaoë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ ëª¨ë“  DAOì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í…œí”Œë¦¿ í´ë˜ìŠ¤ ì•ˆìœ¼ë¡œ ì˜®ê²¨ë„ ëœë‹¤.

```java
public class JdbcContext {
		...
		public void executeSql(final String query) throws SQLException {
				workWithStatementStrategy(
						new StatementStrategy() {
								public PreparedStatement makePreparedStatement(Connection c)
												throws SQLException {
										return c.prepareStatement(query);
								}
						}
			  };
		}
```

```java
public void deleteAll() throws SQLException {
		this.jdbcContext.executeSql("delete from users");
}
```

# ìŠ¤í”„ë§ì˜ JdbcTemplate

ìŠ¤í”„ë§ì€ JDBCë¥¼ ì´ìš©í•˜ëŠ” DAOì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì¤€ë¹„ëœ ë‹¤ì–‘í•œ í…œí”Œë¦¿ê³¼ ì½œë°±ì„ ì œê³µí•œë‹¤. â†’ `JdbcTemplate`

```java
public class UserDaoJdbc implements UserDao {

    // JdbcTemplateì€ ìƒì„±ìì˜ íŒŒë¼ë¯¸í„°ë¡œ DataSourceë¥¼ ì£¼ì…í•œë‹¤.
		private JdbcTemplate jdbcTemplate; 

		public void setDataSource(DataSource dataSource) {
			this.jdbcTemplate = new JdbcTemplate(dataSource);
		}
```

## update()

deleteAll()ì— ì ìš©í•´ë³´ì.

![update()](https://github.com/user-attachments/assets/d1732dd8-fa35-4874-a810-1489f7f2ca1d)

```java
public void deleteAll() {
    this.jdbcTemplate.update(
        new PreparedStatementCreator() {
          @Override
          public PreparedStatement createPreparedStatement(Connection con) throws SQLException {
            return con.prepareStatement("delete from users");
          }
        }
    );
  }
```

`ëŒë‹¤ ì‚¬ìš©`

```java
public void deleteAll() {
    this.jdbcTemplate.update(
        con -> con.prepareStatement("delete from users")
    );
  }
```

- ì½œë°± : PreparedStatement.createPreparedStatement()

```java
PreparedStatement ps =
		c.prepareStatement("insert into users(id, name, password) values(?,?,?)");
ps.setString(1, user.getId());
ps.setString(2, user.getName());
ps.setString(3, user.getPassword());
```

ìœ„ ê²½ìš°ì—ëŠ” ë°”ì¸ë”©í•  íŒŒë¼ë¯¸í„°ëŠ” ìˆœì„œëŒ€ë¡œ ë„£ì–´ì¤€ë‹¤.

![update()](https://github.com/user-attachments/assets/c2d99244-6c1b-44cb-9847-acf474c13033)

```java
public void deleteAll() {
    this.jdbcTemplate.update("insert into users(id, name, password) values (?,?,?)", 
		    user.getId(), user.getName(), user.getPassword());
  }
```

## queryForInt()

getCount()ì—ë„ ì ìš©í•´ë³´ì.

ì´ë•Œ query() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

![query()](https://github.com/user-attachments/assets/c429914a-6da1-444f-bc4c-3565ea6a48ac)

1. `PreparedStatementCreator`ëŠ” update()ì—ì„œ ì‚¬ìš©í•œ ê²ƒê³¼ ê°™ì´ Statement ìƒì„±í•œë‹¤.
2. `ResultSetExtractor`ëŠ” í…œí”Œë¦¿ìœ¼ë¡œë¶€í„° ResultSetì„ ë°›ê³  ê±°ê¸°ì„œ ì¶”ì¶œí•œ ê²°ê³¼ë¥¼ í…œí”Œë¦¿ì— ì „ë‹¬í•˜ë©´, í…œí”Œë¦¿ì€ ë‚˜ë¨¸ì§€ ì‘ì—…ì„ ìˆ˜í–‰í•œ ë’¤ ê·¸ ê°’ì„ query() ë©”ì†Œë“œì˜ ë¦¬í„´ ê°’ìœ¼ë¡œ ëŒë ¤ì¤€ë‹¤.

```java
public int getCount() {
    return this.jdbcTemplate.query(new PreparedStatementCreator() {
      @Override
      public PreparedStatement createPreparedStatement(Connection con) throws SQLException {
        return con.prepareStatement("select count(*) from users");
      }
    }, new ResultSetExtractor<Integer>() {
      @Override
      public Integer extractData(ResultSet rs) throws SQLException, DataAccessException {
        rs.next();
        return rs.getInt(1);
      }
    });
  }
```

- `ResultSetExtractor`ëŠ” ì œë„¤ë¦­ìŠ¤ íƒ€ì… íŒŒë¼ë¯¸í„°ë¥¼ ê°–ëŠ”ë‹¤.
- JDBCëŠ” ë‘ ë²ˆì§¸ ì½œë°±ì¸ `ResultSetExtractor`ì½œë°±ì„ í…œí”Œë¦¿ ì•ˆìœ¼ë¡œ ì˜®ê²¨ ì¬í™œìš© í•  ìˆ˜ ìˆë‹¤.

â†’ JdbcTemplateì€ ì´ëŸ° ê¸°ëŠ¥ì„ ê°€ì§„ ì½œë°±ì„ ë‚´ì¥í•œ `queryForInt()` ë©”ì†Œë“œë¥¼ ì œê³µí•œë‹¤.

> â—
>
> JDBC 6.2.1 ê¸°ì¤€, queryForInt()ëŠ” `Deprecated`ë˜ì„œ `queryForObject()`ë¥¼ ì‚¬ìš©í•œë‹¤.
> 
> ```java
> @Override
> @Nullable
> public <T> T queryForObject(String sql, Class<T> requiredType) throws DataAccessException {
>  return queryForObject(sql, getSingleColumnRowMapper(requiredType));
> }
> ```

```java
public int getCount() {
    return this.jdbcTemplate.queryForObject("select count(*) from users", Integer.class);
}
```

## queryForObject()

get() ë©”ì†Œë“œì—ì„œ ResultSetì— getCount() ì²˜ëŸ¼ ë‹¨ìˆœí•œ ê°’ì´ ì•„ë‹Œ, ë³µì¡í•œ User ì˜¤ë¸Œì íŠ¸ë¡œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•œë‹¤.

ì´ë•Œ getCount()ì—ì„œ ì ìš©í–ˆë˜ `ResultSetExtractor` ëŒ€ì‹  `RowMapper` ì½œë°±ì„ ì‚¬ìš©í•œë‹¤.

> `ResultSetExtractor` VS `RowMapper`
>
- ê³µí†µ
    - ëª¨ë‘ í…œí”Œë¦¿ìœ¼ë¡œë¶€í„° ResultSetì„ ì „ë‹¬ë°›ê³ , í•„ìš”í•œ ì •ë³´ë¥¼ ì¶œì¶œí•´ì„œ ë¦¬í„´í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤.
- ì°¨ì´
    - `ResultSetExractor`ëŠ” ResultSetì„ í•œ ë²ˆ ì „ë‹¬ë°›ì•„ ì•Œì•„ì„œ ì¶”ì¶œ ì‘ì—…ì„ ëª¨ë‘ ì§„í–‰í•˜ê³  ìµœì¢… ê²°ê³¼ë§Œ ë¦¬í„´í•œë‹¤.
    - `RowMapper`ëŠ” ResultSetì˜ ë¡œìš° í•˜ë‚˜ë¥¼ ë§¤í•‘í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì— ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œë  ìˆ˜ ìˆë‹¤.

`queryForObject()ì™€ RowMapperë¥¼ ì ìš©í•œ get()`

```java
public User get(String id) {
    return this.jdbcTemplate.queryForObject("select * from user where id = ?",
        new Object[] {id}, // SQLì— ë°”ì¸ë”©í•  íŒŒë¼ë¯¸í„° ê°’, ê°€ë³€ì¸ì ëŒ€ì‹  ë°°ì—´ì„ ì‚¬ìš©í•œë‹¤.
        new RowMapper<User>() {
          @Override
          public User mapRow(ResultSet rs, int rowNum) throws SQLException {
            User user = new User();
            user.setId(rs.getString("id"));
            user.setName(rs.getString("name"));
            user.setPassword(rs.getString("password"));
            return user;
          }
        });
  }
```

## query()

User í…Œì´ë¸”ì˜ ì „ì²´ í–‰ì„ ê°€ì ¸ì˜¤ëŠ” ì¿¼ë¦¬ë¥¼ ê°€ì ¸ì˜¤ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?

`queryObject()`ëŠ” ì¿¼ë¦¬ì˜ ê²°ê³¼ê°€ í•˜ë‚˜ì¼ ë•Œ ì‚¬ìš©í•œë‹¤.

ì—¬ëŸ¬ ê°œë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„ , `query()`ë¥¼ ì‚¬ìš©í•œë‹¤. ë¦¬í„´ íƒ€ì…ì€ List<T>ë‹¤.

```java
public List<User> getAll() {
    return this.jdbcTemplate.query("select * from users order by id",
        new RowMapper<User>() {
          @Override
          public User mapRow(ResultSet rs, int rowNum) throws SQLException {
            User user = new User();
            user.setId(rs.getString("id"));
            user.setName(rs.getString("name"));
            user.setPassword(rs.getString("password"));
            return user;
          }
        });
  }
```

## ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì½œë°±ì˜ ë¶„ë¦¬

### ì¤‘ë³µ ì œê±°

get()ê³¼ getAll()ì„ ë³´ë©´ RowMapperì˜ ë‚´ìš©ì´ ë˜‘ê°™ì€ ì½œë°±ì´ë‹¤.

ê·¼ë° get(), getAll() ë¿ë§Œ ì•„ë‹ˆë¼ ì •ë ¬ ì¡°ê±´ì´ ì¶”ê°€ë˜ëŠ” ë“± ì—¬ëŸ¬ ì¡°ê±´ì´ ì¶”ê°€ë˜ë©´ì„œ ë©”ì†Œë“œê°€ ìƒì„±ë˜ë©´ RowMapperëŠ” ì¤‘ë³µëœë‹¤.

ë”°ë¼ì„œ Userìš© RowMapper ì½œë°±ì„ ì¬ì‚¬ìš©ë˜ê²Œ ë§Œë“¤ì–´ë³´ì.

```java
private RowMapper<User> userMapper =
      new RowMapper<User>() {
        @Override
        public User mapRow(ResultSet rs, int rowNum) throws SQLException {
          User user = new User();
          user.setId(rs.getString("id"));
          user.setName(rs.getString("name"));
          user.setPassword(rs.getString("password"));
          return user;
        }
      };
```

```java
public User get(String id) {
		return this.jdbcTemplate.queryForObject("select * from users where id = ?",
				new Object[] {id}, this.userMapper);
}
---
public List<User> getAll() {
		return this.jdbcTemplate.query("select * from users order by id",this.userMapper);
}
```
