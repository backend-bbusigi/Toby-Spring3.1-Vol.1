# 3ì¥ í…œí”Œë¦¿
## 3.1 ë‹¤ì‹œ ë³´ëŠ” ì´ˆë‚œê° DAO

### í…œí”Œë¦¿ì´ë€?

**ì¼ì • íŒ¨í„´ìœ¼ë¡œ ìœ ì§€**ë˜ëŠ” ë¶€ë¶„ì„Â **í™•ì¥ë˜ëŠ” ë¶€ë¶„**ìœ¼ë¡œë¶€í„°Â **ë…ë¦½**ì‹œì¼œ íš¨ê³¼ì ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë°©ë²•

ì±…ì—ì„œëŠ” `UserDAO`ì—ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” ë¶€ë¶„(ë³€í™”)ê³¼ DBë¥¼ ì—°ê²°í•˜ëŠ” ë¶€ë¶„(ê³ ì •)ì„ ë‚˜ëˆ„ì—ˆë‹¤.

ê¸°ì¡´ JDBC ì½”ë“œëŠ” ì˜ˆì™¸ì²˜ë¦¬ê°€ ë˜ì–´ ìˆì§€ ì•Šì•„ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

### JDBC ìˆ˜ì • ê¸°ëŠ¥ ì˜ˆì™¸ì²˜ë¦¬

> **ê¸°ì¡´ ì½”ë“œ**
> 

```java
public void deleteAll() throws SQLException {
    Connection c = dataSource.getConnection();
    
    PreparedStatement ps = c.prepareStatement("delete from users");
    ps.executeUpdate();
    
    ps.close();
    c.close();
}
```

- **JDBCì—ì„œ Connection**ê³¼ **PreparedStatement**ëŠ” ì œí•œëœ ë¦¬ì†ŒìŠ¤ì´ë¯€ë¡œ ë°˜ë“œì‹œ ë°˜í™˜í•´ì•¼ í•œë‹¤.
- ì˜ˆì™¸ê°€ ë°œìƒí•´ ë¦¬ì†ŒìŠ¤ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šìœ¼ë©´, DB ì»¤ë„¥ì…˜ í’€ ê³ ê°ˆë¡œ ì„œë²„ê°€ ì¤‘ë‹¨ë  ìˆ˜ ìˆë‹¤.

â¡ï¸Â ì˜ˆì™¸ê°€ ë°œìƒí•˜ë”ë¼ë„ ë¦¬ì†ŒìŠ¤ ë°˜í™˜ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ `try/catch/finally` êµ¬ë¬¸ì„ ì‚¬ìš©í•œë‹¤.

> **try/catch/finally êµ¬ë¬¸ì„ ì´ìš©í•´ ê°œì„ í•œ ì½”ë“œ**
> 

`close()` ë„ SQLExceptionì´ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— `try/catch` ë¸”ë¡ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤˜ì•¼ í•œë‹¤.

```java
public void deleteAll() throws SQLException {
    Connection c = null;
    PreparedStatement ps = null;
    try {
        c = dataSource.getConnection();
        ps = c.prepareStatement("delete from users");
        ps.executeUpdate();
    } catch (SQLException e) {
        throw e;  
    } finally { //ì˜ˆì™¸ ë°œìƒ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ finally ë¸”ë¡ì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ë°˜ë“œì‹œ ë‹«ì•„ì¤˜ì•¼ í•œë‹¤.
        if (ps != null) {
            try {
                ps.close();
            } catch (SQLException e) {
            }
        }
        if (c != null) {
            try {
                c.close();
            } catch (SQLException e) {
            }
        }
    }
}
```

### JDBC ì¡°íšŒ ê¸°ëŠ¥ ì˜ˆì™¸ì²˜ë¦¬

- ì¡°íšŒ ì‘ì—…ì—ì„œëŠ” `ResultSet`ë„ ë¦¬ì†ŒìŠ¤ë¥¼ ë°˜í™˜í•´ì¤˜ì•¼ í•œë‹¤.

> **try/catch/finally êµ¬ë¬¸ì„ ì´ìš©í•´ ê°œì„ í•œ ì½”ë“œ**
> 

**ë¦¬ì†ŒìŠ¤ ë°˜í™˜ ìˆœì„œ :** ìƒì„±ëœ ìˆœì„œì˜ ë°˜ëŒ€ë¡œ ë°˜í™˜ (`ResultSet â†’ PreparedStatement â†’ Connection`)

```java
public int getCount() throws SQLException {
    Connection c = null;
    PreparedStatement ps = null;
    ResultSet rs = null;
    try {
        c = dataSource.getConnection();
        ps = c.prepareStatement("select count(*) from users");
        rs = ps.executeQuery();
        rs.next();
        return rs.getInt(1);
    } catch (SQLException e) {
        throw e;
    } finally {
        if (rs != null) {
            try {
                rs.close();
            } catch (SQLException e) {
                // ResultSet ë‹«ê¸° ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬
            }
        }
        if (ps != null) {
            try {
                ps.close();
            } catch (SQLException e) {
                // PreparedStatement ë‹«ê¸° ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬
            }
        }
        if (c != null) {
            try {
                c.close();
            } catch (SQLException e) {
                // Connection ë‹«ê¸° ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬
            }
        }
    }
}
```

## 3.2 ë³€í•˜ëŠ” ê²ƒê³¼ ë³€í•˜ì§€ ì•ŠëŠ” ê²ƒ

í•˜ì§€ë§Œ ì´ë ‡ê²Œ ê³„ì† try/catch/finally ì½”ë“œë¥¼ ë³µë¶™í•˜ëŠ” ê±´ ë§ì´ ì•ˆë¨

### ë¶„ë¦¬ì™€ ì¬ì‚¬ìš©ì„ ìœ„í•œ ë””ìì¸ íŒ¨í„´ ì ìš©

deleteAll() ë©”ì„œë“œë¥¼ ë³´ë©´, **`ps = c.prepareStatement("delete from users")ï¼›`** ì´ì™¸ì—ëŠ” ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤.

![image](https://github.com/user-attachments/assets/839e652a-7fec-4faf-8145-4a8f3b9a43e0)


ì´ ë³€í•˜ëŠ” ë¶€ë¶„ì„, ë³€í•˜ì§€ ì•ŠëŠ” ë‚˜ë¨¸ì§€ ì½”ë“œì—ì„œ ë¶„ë¦¬í•´ì„œ **ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì„ ì¬ì‚¬ìš©**í•´ì•¼ í•œë‹¤.

### 1. ë©”ì„œë“œ ì¶”ì¶œ



### 2. í…œí”Œë¦¿ ë©”ì„œë“œ íŒ¨í„´ì˜ ì ìš©

**í…œí”Œë¦¿ ë©”ì„œë“œ íŒ¨í„´ : ìƒì†ì„ í†µí•´ ê¸°ëŠ¥ì„ í™•ì¥í•´ì„œ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´**

- ë³€í•˜ì§€ ì•ŠëŠ” **ê³µí†µ ë¡œì§**ì€ **ìŠˆí¼í´ë˜ìŠ¤**ì— ì •ì˜
- ë³€í•˜ëŠ” ë¶€ë¶„ì€ **ì¶”ìƒ ë©”ì†Œë“œ**ë¡œ ì„ ì–¸í•´ì„œ í•˜ìœ„ í´ë˜ìŠ¤ì—ì„œ ì˜¤ë²„ë¼ì´ë“œí•˜ë„ë¡ ì„¤ê³„

> **í…œí”Œë¦¿ ë©”ì„œë“œ íŒ¨í„´ì„ ì ìš©í•œ ì½”ë“œ**
> 
- ìŠˆí¼í´ë˜ìŠ¤ `UserDao`ëŠ” ê³µí†µëœ `try/catch/finally` êµ¬ì¡°ë¥¼ ì œê³µí•œë‹¤.
- `PreparedStatement`ë¥¼ ìƒì„±í•˜ëŠ” ì‘ì—…ì„ `makeStatement()`ë¼ëŠ” ì¶”ìƒ ë©”ì†Œë“œë¡œ ì •ì˜í•œë‹¤.
- í•˜ìœ„ í´ë˜ìŠ¤(`UserDaoDeleteAll`)ì—ì„œ `makeStatement()`ë¥¼ êµ¬í˜„í•˜ì—¬ **íŠ¹ì • ì¿¼ë¦¬**ë¥¼ ì •ì˜í•œë‹¤.

```java
abstract class UserDao {
    public void deleteAll() throws SQLException {
        Connection c = null;
        PreparedStatement ps = null;
        try {
            c = dataSource.getConnection();
            ps = makeStatement(c);
            ps.executeUpdate();
        } catch (SQLException e) {
            throw e;
        } finally {
            if (ps != null) ps.close();
            if (c != null) c.close();
        }
    }

    abstract protected PreparedStatement makeStatement(Connection c) throws SQLException;
}

public class UserDaoDeleteAll extends UserDao {
    @Override
    protected PreparedStatement makeStatement(Connection c) throws SQLException {
        return c.prepareStatement("delete from users");
    }
}
```

âœ…Â **ì¥ì **

1. ê°œë°© íì‡„ ì›ì¹™(OCP)ì„ ì˜ ì§€ì¼°ë‹¤.
2. **`@Override`** ë¥¼ í†µí•´ ë³€í™”ì—ëŠ” ì—´ë ¤ìˆê³ , ë³€ê²½ì—ëŠ” ë‹«í˜€ìˆë‹¤.

**â˜‘ï¸Â ë¬¸ì œì **

1. DAO ë¡œì§ë§ˆë‹¤ ìƒˆë¡œìš´ DAO í´ë˜ìŠ¤(í•˜ìœ„ í´ë˜ìŠ¤)ë¥¼ ê³„ì† ë§Œë“¤ì–´ì•¼ í•œë‹¤.
2. í™•ì¥êµ¬ì¡°ê°€ í´ë˜ìŠ¤ ì„¤ê³„ ì‹œì ì— ì •í•´ì ¸ì„œ ê´€ê³„ì— ëŒ€í•œ ìœ ì—°ì„±ì´ ë–¨ì–´ì§„ë‹¤.

### 3. ì „ëµ íŒ¨í„´ì˜ ì ìš©

**ì „ëµ íŒ¨í„´ : ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì˜ì¡´í•˜ê²Œ í•˜ëŠ” íŒ¨í„´**

- ë³€í•˜ì§€ ì•ŠëŠ” **ê³µí†µ ë¡œì§**(ì»¨í…ìŠ¤íŠ¸)ì€ ìœ ì§€í•˜ê³ , ë³€í•˜ëŠ” ë¶€ë¶„ì„ **ì¸í„°í˜ì´ìŠ¤**ë¡œ ì •ì˜
    
    â†’ ì´ë¥¼ êµ¬í˜„í•œ **êµ¬ì²´ì ì¸ ì „ëµ í´ë˜ìŠ¤**ë¥¼ ì™¸ë¶€ì—ì„œ ì£¼ì…ë°›ì•„ ì‹¤í–‰í•œë‹¤.
    
- ìƒì† ëŒ€ì‹  **êµ¬ì„±(Composition)**ì„ ì‚¬ìš©í•˜ì—¬ í™•ì¥ì„±ì„ ë†’ì„

> **ì „ëµ íŒ¨í„´ì„ ì‚¬ìš©í•œ ì½”ë“œ**
> 
- `StatementStrategy` ì¸í„°í˜ì´ìŠ¤ë¡œ ë³€í•˜ëŠ” ë¶€ë¶„(PreparedStatement ìƒì„± ë¡œì§)ì„ ì¶”ìƒí™”
- êµ¬ì²´ì ì¸ ì „ëµ í´ë˜ìŠ¤(`DeleteAllStatement`)ì—ì„œ `makePreparedStatement()`ë¥¼ êµ¬í˜„
- `deleteAll()` ë©”ì†Œë“œì—ì„œëŠ” ì „ëµ ê°ì²´ë¥¼ ë°›ì•„ JDBC ì‘ì—… ìˆ˜í–‰

```java
public interface StatementStrategy {
    PreparedStatement makePrepareStatement(Connection c) throws SQLException;
}

public class DeleteAllStatement implements StatementStrategy{
    @Override
    public PreparedStatement makePrepareStatement(Connection c) throws SQLException {
        PreparedStatement ps = c.prepareStatement("delete from users");
        return ps;
    }
}

public void deleteAll() throws SQLException {
        PreparedStatement ps = null;
        Connection c = null;
        try {
            c = dataSource.getConnection();
            // ë¬¸ì œ - UserDaoê°€ êµ¬ì²´ì ì¸ ì „ëµì„ êµ¬í˜„í•˜ê³  ìˆìŒ
            StatementStrategy strategy = new DeleteAllStatement();
            ps = strategy.makePrepareStatement(c);
            ps.executeUpdate();
        } catch (SQLException e) {
            throw e;
        } finally {
            ...
        }
    }
```

âœ…Â **ì¥ì **

1. í´ë˜ìŠ¤ ìƒì† ëŒ€ì‹  ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•´ì„œ ë” ìœ ì—°í•´ì¡Œë‹¤.
2. ê°œë°© íì‡„ ì›ì¹™ì„ ë” ì˜ ì§€í‚¨ë‹¤.

**â˜‘ï¸Â ë¬¸ì œì **

í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì—ì„œ ì „ëµ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì£¼ì…í•´ì•¼í•œë‹¤.

### 4. DI ì ìš©ì„ ìœ„í•œ í´ë¼ì´ì–¸íŠ¸/ì»¨í…ìŠ¤íŠ¸ ë¶„ë¦¬

> í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì—ì„œ ì „ëµ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ëŒ€ì‹ , DI ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•˜ì—¬ **ì „ëµ ê°ì²´ë¥¼ ì£¼ì…í•œë‹¤.**
> 

**ê²°êµ­ DIë€, ì „ëµ íŒ¨í„´ì˜ ì¥ì ì„ ì¼ë°˜ì ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆë„ë¡ ë§Œë“  êµ¬ì¡°ë‹¤.**

- UserDaoì™€ StatementStrategyì˜ ê²°í•©ë„ë¥¼ ë‚®ì¶”ê³  ìœ ì—°ì„±ì„ ê·¹ëŒ€í™”

```java
public class DeleteAllStatement implements StatementStrategy{
    @Override
    public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
        return c.prepareStatement("delete from users");
    }
}

public void jdbcContextWithStatementStrategy(StatementStrategy stmt) throws SQLException {
    Connection c = null;
    PreparedStatement ps = null;

    try {
        c = dataSource.getConnection();
        
        **ps = stmt.makePreparedStatement(c);**

        ps.executeUpdate();
    } catch (SQLException e) {
        throw e;
    } finally {
        if(ps != null) { try { ps.close(); } catch (SQLException e) { } }
        if(c != null) { try { c.close(); } catch (SQLException e) { } }
    }
}

public void deleteAll() throws SQLException {
    StatementStrategy strategy = new DeleteAllStatement(); // ì„ ì •í•œ ì „ëµ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ ìƒì„±
    jdbcContextWithStatementStrategy(strategy); // ì»¨í…ìŠ¤íŠ¸ í˜¸ì¶œ, ì „ëµ ì˜¤ë¸Œì íŠ¸ ì „ë‹¬
}
```

- í™•ì¥ ì½”ë“œ
    
    ```java
    import java.sql.*;
    import java.util.ArrayList;
    import java.util.List;
    
    public class UserDao {
        private final DataSource dataSource;
    
        public UserDao(DataSource dataSource) {
            this.dataSource = dataSource;
        }
        
        public class DeleteAllStatement implements StatementStrategy {
        @Override
        public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
            return c.prepareStatement("delete from users");
        }
    }
    		public class DeleteUserByIdStatement implements StatementStrategy {
        private final int userId;
    
        public DeleteUserByIdStatement(int userId) {
            this.userId = userId;
        }
    
        @Override
        public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
            PreparedStatement ps = c.prepareStatement("delete from users where id = ?");
            ps.setInt(1, userId);
            return ps;
        }
    }
    		public class UpdateUserEmailStatement implements StatementStrategy {
        private final int userId;
        private final String newEmail;
    
        public UpdateUserEmailStatement(int userId, String newEmail) {
            this.userId = userId;
            this.newEmail = newEmail;
        }
    
        @Override
        public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
            PreparedStatement ps = c.prepareStatement("update users set email = ? where id = ?");
            ps.setString(1, newEmail);
            ps.setInt(2, userId);
            return ps;
        }
    }
    
        public void jdbcContextWithStatementStrategy(StatementStrategy stmt) throws SQLException {
            Connection c = null;
            PreparedStatement ps = null;
    
            try {
                c = dataSource.getConnection();
                ps = stmt.makePreparedStatement(c);
                ps.executeUpdate();
            } catch (SQLException e) {
                throw e;
            } finally {
                if (ps != null) {
                    try {
                        ps.close();
                    } catch (SQLException e) {
                        // ë¡œê·¸ ì²˜ë¦¬ ë˜ëŠ” ë¬´ì‹œ
                    }
                }
                if (c != null) {
                    try {
                        c.close();
                    } catch (SQLException e) {
                        // ë¡œê·¸ ì²˜ë¦¬ ë˜ëŠ” ë¬´ì‹œ
                    }
                }
            }
        }
    
        public void deleteAll() throws SQLException {
            StatementStrategy strategy = new DeleteAllStatement();
            jdbcContextWithStatementStrategy(strategy);
        }
    
        public void deleteUserById(int userId) throws SQLException {
            StatementStrategy strategy = new DeleteUserByIdStatement(userId);
            jdbcContextWithStatementStrategy(strategy);
        }
    
        public void updateUserEmail(int userId, String newEmail) throws SQLException {
            StatementStrategy strategy = new UpdateUserEmailStatement(userId, newEmail);
            jdbcContextWithStatementStrategy(strategy);
        }
    
        public List<User> findAllUsers() throws SQLException {
            StatementStrategy strategy = new SelectAllUsersStatement();
            List<User> users = new ArrayList<>();
    
            try (Connection c = dataSource.getConnection();
                 PreparedStatement ps = strategy.makePreparedStatement(c);
                 ResultSet rs = ps.executeQuery()) {
    
                while (rs.next()) {
                    User user = new User();
                    user.setId(rs.getInt("id"));
                    user.setName(rs.getString("name"));
                    user.setEmail(rs.getString("email"));
                    users.add(user);
                }
            }
    
            return users;
        }
    }
    
    ```
    

## 3.3 JDBC ì „ëµ íŒ¨í„´ì˜ ìµœì í™”

**â˜‘ï¸Â ë¬¸ì œì **

1. DAO ë©”ì„œë“œë§ˆë‹¤ ìƒˆë¡œìš´ Statementstrategy êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•´ í´ë˜ìŠ¤ íŒŒì¼ì´ ë§ì•„ì§„ë‹¤.
    
    â¡ï¸ Statementstrategy ì „ëµ í´ë˜ìŠ¤ë¥¼ ë§¤ë²ˆ ë…ë¦½ëœ íŒŒì¼ë¡œ ë§Œã„·ë¥´ì§€ ë§ê³  UserDao í´ë˜ìŠ¤ ì•ˆì— ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ì •ì˜
    
2. DAO ë©”ì„œë“œì—ì„œ Statementstrategyì— ì „ë‹¬í•  User ê°™ì€ ë¶€ê°€ì ì¸ ì •ë³´ê°€ ìˆì„ ê²½ìš°, ìƒì„±ìì™€ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤.
    
    â¡ï¸ ì „ëµ í´ë˜ìŠ¤ë¥¼ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ë³€í™˜
    

<aside>
ğŸ€

**ì¤‘ì²© í´ë˜ìŠ¤(nested class)ì˜ ì¢…ë¥˜**

ì¤‘ì²© í´ë˜ìŠ¤ : ë‹¤ë¥¸ í´ë˜ìŠ¤ ë‚´ë¶€ì— ì •ì˜ë˜ëŠ” í´ë˜ìŠ¤

1. static class
    - ë…ë¦½ì ìœ¼ë¡œ ì˜¤ë¸Œì íŠ¸ë¡œ ë§Œë“¤ì–´ì§ˆ ìˆ˜ ìˆëŠ” í´ë˜ìŠ¤
2. ë‚´ë¶€ í´ë˜ìŠ¤ (inner class)
    - ìì‹ ì´ ì •ì˜ëœ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ ì•ˆì—ì„œë§Œ ë§Œë“¤ì–´ì§ˆ ìˆ˜ ìˆëŠ” í´ë˜ìŠ¤
    - ë²”ìœ„ì— ë”°ë¼ ì„¸ ê°€ì§€ë¡œ êµ¬ë¶„ëœë‹¤.
    1. ë©¤ë²„ ë‚´ë¶€ í´ë˜ìŠ¤ : ì˜¤ë¸Œì íŠ¸ ë ˆë²¨ì— ì •ì˜ë¨
    2. ë¡œì»¬ í´ë˜ìŠ¤ : ë©”ì„œë“œ ë ˆë²¨ì— ì •ì˜ë¨
    3. ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ : ì´ë¦„ì„ ê°–ì§€ ì•ŠëŠ” í´ë˜ìŠ¤
</aside>

### 1. ë¡œì»¬ í´ë˜ìŠ¤ ì‚¬ìš©

> Statementstrategy ì „ëµ í´ë˜ìŠ¤ë¥¼ ë§¤ë²ˆ ë…ë¦½ëœ íŒŒì¼ë¡œ ë§Œë“¤ì§€ ë§ê³  UserDao í´ë˜ìŠ¤ ì•ˆì— ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ì •ì˜í•œë‹¤.
> 
- ë¡œì»¬ í´ë˜ìŠ¤ëŠ” ì„ ì–¸ëœ ë©”ì†Œë“œì˜ ë³€ìˆ˜ì™€ íŒŒë¼ë¯¸í„°ì— ì§ì ‘ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.
- ë‹¨, ë‚´ë¶€ í´ë˜ìŠ¤ì—ì„œ ì™¸ë¶€ì˜ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì™¸ë¶€ ë³€ìˆ˜ëŠ” ë°˜ë“œì‹œ **`final`** ì´ì–´ì•¼ í•œë‹¤.

```java
public void add(**final** User user) throws SQLException {
    class AddStatement implements StatementStrategy {
        @Override
        public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
            PreparedStatement ps = c.prepareStatement(
                "insert into users(id, name, password) values(?, ?, ?)"
            );
            ps.setString(1, user.getId());
            ps.setString(2, user.getName());
            ps.setString(3, user.getPassword());
            return ps;
        }
    }

    StatementStrategy st = new AddStatement(); // ë¡œì»¬ í´ë˜ìŠ¤ ê°ì²´ ìƒì„±
    jdbcContextWithStatementStrategy(st);      // ì»¨í…ìŠ¤íŠ¸ í˜¸ì¶œ
}
```

### 2. ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤(anonymous inner class)

> í´ë˜ìŠ¤ ì´ë¦„ì„ ì œê±°í•´ ì¡°ê¸ˆ ë” ê°„ê²°í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
> 

**`new ì¸í„°í˜ì´ìŠ¤_ì´ë¦„() {í´ë˜ìŠ¤ ë³¸ë¬¸};`**

- íŠ¹ì • DAO ë©”ì†Œë“œì—ì„œë§Œ ì‚¬ìš©í•  ì „ëµ í´ë˜ìŠ¤ë¼ë©´, **ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤**ë¡œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
- **ì„ ì–¸ê³¼ ë™ì‹œì— ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.**

```java
public void add(final User user) throws SQLException {
    jdbcContextWithStatementStrategy(
        new StatementStrategy() { // ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤
            @Override
            public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
                PreparedStatement ps = c.prepareStatement(
                    "insert into users(id, name, password) values(?, ?, ?)"
                );
                ps.setString(1, user.getId());
                ps.setString(2, user.getName());
                ps.setString(3, user.getPassword());
                return ps;
            }
        }
    );
}
```

## 3.4 ì»¨í…ìŠ¤íŠ¸ì™€ DI

- ì „ëµ: DeleteAllStatement í´ë˜ìŠ¤ - ë³€í•˜ëŠ” ë¶€ë¶„ì— ëŒ€í•œ êµ¬í˜„
- ì»¨í…ìŠ¤íŠ¸: UserDao.jdbcContextWithStatementStrategy() - ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„
- í´ë¼ì´ì–¸íŠ¸: UserDao.deleteAll() - ì „ëµê³¼ ì»¨í…ìŠ¤íŠ¸ê°€ í•©ì³ì ¸ ìµœì¢…ì ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ê°€ ì‚¬ìš©í•˜ëŠ” ë©”ì„œë“œ
    
    **`jdbcContextWithStatementStrategy()`**ë¥¼ UserDao í´ë˜ìŠ¤ ë°–ìœ¼ë¡œ ë…ë¦½ì‹œì¼œì„œ ëª¨ë“  DAOê°€ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ì
    
    â†’ Datasource ì˜ì¡´ì„±ì—ì„œ í•´ë°©ë¨
    

```java
public class JdbcContext {
    private DataSource dataSource;

    // DataSource ì£¼ì…
    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
    }

    // JDBC ì‘ì—… íë¦„ ì²˜ë¦¬ ë©”ì†Œë“œ
    public void workWithStatementStrategy(StatementStrategy stmt) throws SQLException {
        Connection c = null;
        PreparedStatement ps = null;

        try {
            c = this.dataSource.getConnection();
            ps = stmt.makePreparedStatement(c);
            ps.executeUpdate();
        } catch (SQLException e) {
            throw e;
        } finally {
            if (ps != null) try { ps.close(); } catch (SQLException e) { }
            if (c != null) try { c.close(); } catch (SQLException e) { }
        }
    }
}
```

```java
public class UserDao {
    private JdbcContext jdbcContext;

    // JdbcContext ì£¼ì…
    public void setJdbcContext(JdbcContext jdbcContext) {
        this.jdbcContext = jdbcContext;
    }

    // ì‚¬ìš©ì ì¶”ê°€ ë©”ì†Œë“œ
    public void add(final User user) throws SQLException {
        this.jdbcContext.workWithStatementStrategy(
            new StatementStrategy() { // ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ ì‚¬ìš©
                @Override
                public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
                    PreparedStatement ps = c.prepareStatement(
                        "insert into users(id, name, password) values(?, ?, ?)"
                    );
                    ps.setString(1, user.getId());
                    ps.setString(2, user.getName());
                    ps.setString(3, user.getPassword());
                    return ps;
                }
            }
        );
    }

    // ëª¨ë“  ì‚¬ìš©ì ì‚­ì œ ë©”ì†Œë“œ
    public void deleteAll() throws SQLException {
        this.jdbcContext.workWithStatementStrategy(
            new StatementStrategy() { // ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ ì‚¬ìš©
                @Override
                public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
                    return c.prepareStatement("delete from users");
                }
            }
        );
    }
}
```

### **í´ë˜ìŠ¤ ì˜ì¡´ ê´€ê³„**

1. `JdbcContext`ëŠ” `DataSource`ì— ì˜ì¡´
2. `UserDao`ëŠ” `JdbcContext`ì— ì˜ì¡´



### JdbcContextì˜ íŠ¹ë³„í•œ DI

ì´ìƒì ì¸ DIëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•´ ëŸ°íƒ€ì„ ì‹œì— ì˜ì¡´ ê´€ê³„ë¥¼ ìœ ì—°í•˜ê²Œ ë³€ê²½í•  ìˆ˜ ìˆì–´ì•¼ í•˜ì§€ë§Œ

`UserDao`ëŠ” `JdbcContext`ë¼ëŠ” êµ¬ì²´ í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ì˜ì¡´í•´ **í´ë˜ìŠ¤ ë ˆë²¨ì—ì„œ ê³ ì •**ë˜ì–´ ëŸ°íƒ€ì„ì— ë³€ê²½í•  ìˆ˜ ì—†ë‹¤.

> **ìŠ¤í”„ë§ì˜ DI**ëŠ” ê°ì²´ ê°„ì˜ ê´€ê³„ ì„¤ì •ì„ ì™¸ë¶€ë¡œ ìœ„ì„í•˜ëŠ” IoC ê°œë…ì„ í¬ê´„í•˜ë¯€ë¡œ, í˜„ì¬ ë°©ì‹ë„ DIë¡œ ë³¼ ìˆ˜ ìˆë‹¤.
> 

### DI ë°©ë²• 1: JdbcContextë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡

**DI êµ¬ì¡°ë¥¼ ìœ ì§€í•´ì•¼ í•˜ëŠ” ì´ìœ **

1. `JdbcContext`ê°€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ê´€ë¦¬ë˜ëŠ” ì‹±ê¸€í†¤ ë¹ˆì´ ë˜ê¸° ë•Œë¬¸
    - `JdbcContext`ëŠ” ìƒíƒœë¥¼ ê°–ì§€ ì•Šìœ¼ë©°, `DataSource`ë¥¼ ì½ê¸° ì „ìš©ì´ë‹¤.
    
    â‡’ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ ì‹±ê¸€í†¤ ë¹ˆìœ¼ë¡œ ê´€ë¦¬í•˜ë©° ì—¬ëŸ¬ DAOì—ì„œ ê³µìœ í•˜ëŠ” ê²ƒì´ ì´ìƒì ì´ë‹¤.
    

2. `JdbcContext`ê°€ DIë¥¼ í†µí•´ ë‹¤ë¥¸ ë¹ˆ`(DataSource)`ì— ì˜ì¡´í•˜ê³  ìˆê¸° ë•Œë¬¸

- `JdbcContext`ëŠ” `DataSource`ë¥¼ ì£¼ì…ë°›ì•„ì•¼ í•˜ë¯€ë¡œ, ì´ë¥¼ ìœ„í•´ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ì–´ì•¼ í•œë‹¤.
- ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ê´€ë¦¬ë˜ì§€ ì•Šìœ¼ë©´, `DataSource`ì™€ ê°™ì€ ì˜ì¡´ ê°ì²´ë¥¼ ë‹¤ì´ë‚´ë¯¹í•˜ê²Œ ì£¼ì…ë°›ì„ ìˆ˜ ì—†ë‹¤.

### ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ì´ìœ 

â†’ UserDaoì™€ JdbcContextê°€ ë§¤ìš° ê¸´ë°€í•œ ê´€ê³„ë¥¼ ê°€ì§€ê³  ê°•í•˜ê²Œ ê²°í•©ë˜ì–´ ìˆë‹¤ëŠ” ì˜ë¯¸

UserDaoê°€ JDBC ëŒ€ì‹  JPAë‚˜ í•˜ì´ë²„ë„¤ì´íŠ¸ ê°™ì€ ORMì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´ JdbcContextë¥¼ í†µì§¸ë¡œ ë°”ê¿”ì•¼ í•˜ëŠ”ë° êµ³ì´ ë‹¤ë¥¸ êµ¬í˜„ìœ¼ë¡œ ëŒ€ì²´í•´ì„œ ì‚¬ìš©í•  ì´ìœ ê°€ ì—†ê¸° ë•Œë¬¸

### DI ë°©ë²• 2 : ì½”ë“œë¥¼ ì´ìš©í•˜ëŠ” ìˆ˜ë™ DI

> JdbcContextë¥¼ ìŠ¤í”„ë§ì˜ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì„œ UserDaoì— DIí•˜ëŠ” ëŒ€ì‹ , UserDao ë‚´ë¶€ì—ì„œ ì§ì ‘ DIë¥¼ ì ìš©í•˜ëŠ” ë°©ë²•
> 
- **ì‹±ê¸€í†¤ìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒì„ í¬ê¸°**í•´ì•¼ í•œë‹¤.
- DAO ë©”ì†Œë“œê°€ í˜¸ì¶œë  ë•Œë§ˆë‹¤ JdbcContextë¥¼ ìƒì„±í•˜ì§€ ì•Šê³ ,Â **DAO ë§ˆë‹¤ í•˜ë‚˜ì˜ JdbcContext ì˜¤ë¸Œì íŠ¸**ë¥¼ ê°–ê³  ìˆê²ŒÂ í•œë‹¤.
- `JdbcContext`ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì§€ ì•Šê³ , **UserDaoê°€ ì§ì ‘ ìƒì„±í•œë‹¤.**
- UserDaoê°€ JdbcContextë¥¼ ì˜ì¡´í•˜ê¸° ë•Œë¬¸ì—, UserDaoê°€ JdbcContextì˜ ìƒì„±, ì´ˆê¸°í™”ë¥¼ ë‹´ë‹¹

```java
public class UserDao {
    private JdbcContext jdbcContext;
    private DataSource dataSource;

    public void setDataSource(DataSource dataSource) {
        this.jdbcContext = new JdbcContext();
        this.jdbcContext.setDataSource(dataSource);

        //ì•„ì§ JdbcContextë¥¼ ì ìš©í•˜ì§€ ì•Šì€ ë©”ì†Œë“œë¥¼ ìœ„í•´ ì €ì¥í•´ë‘ 
        this.dataSource = dataSource;
    }
}
```

| **êµ¬ë¶„** | **ì¥ì ** | **ë‹¨ì ** |
| --- | --- | --- |
| **ìŠ¤í”„ë§ DI** | - ì‹¤ì œ ì˜ì¡´ ê´€ê³„ê°€ ì„¤ì • íŒŒì¼(XML)ì— ëª…í™•íˆ ë“œëŸ¬ë‚¨ | - DIì˜ ê·¼ë³¸ì ì¸ ì›ì¹™ì— ë¶€í•©í•˜ì§€ ì•ŠëŠ” êµ¬ì²´ì ì¸ í´ë˜ìŠ¤ì™€ì˜ ê´€ê³„ê°€ ì§ì ‘ ë…¸ì¶œë¨ |
| **ìˆ˜ë™ DI** | - `JdbcContext`ê°€ `UserDao` ë‚´ë¶€ì—ì„œ ë§Œë“¤ì–´ì§€ê³  ì‚¬ìš©ë˜ë©´ì„œ ê´€ê³„ë¥¼ ì™¸ë¶€ì— ë“œëŸ¬ë‚´ì§€ ì•ŠìŒ | - ì‹±ê¸€í†¤ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ì—†ìŒ |
|  |  | - DI ì‘ì—…ì„ ìœ„í•œ ë¶€ê°€ì ì¸ ì½”ë“œê°€ í•„ìš” |

## 3.5 í…œí”Œë¦¿ê³¼ ì½œë°±

> **í…œí”Œë¦¿/ì½œë°± íŒ¨í„´**ì€ **ì „ëµ íŒ¨í„´**ì˜ ë³€í˜• í˜•íƒœì´ë‹¤.
> 
- **`í…œí”Œë¦¿`**: ê³ ì •ëœ ì‘ì—… íë¦„ì„ ê°€ì§„ ì½”ë“œ(**`ì»¨í…ìŠ¤íŠ¸`**)
- **`ì½œë°±`**: í…œí”Œë¦¿ ë‚´ì—ì„œ í˜¸ì¶œë˜ëŠ” ë¡œì§ì„ ê°€ì§„ ì˜¤ë¸Œì íŠ¸(ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ í˜•íƒœ- **`ì „ëµ`**)

**íŠ¹ì§•**

- ì½œë°± ì¸í„°í˜ì´ìŠ¤ëŠ” ë³´í†µ í•˜ë‚˜ì˜ ë©”ì†Œë“œë¥¼ ê°€ì§„ë‹¤.
- JdbcContextì˜ `workWithStatementStrategy()`ì—ì„œëŠ” `StatementStrategy` ì¸í„°í˜ì´ìŠ¤ì˜ `makePreparedStatement()` ë©”ì†Œë“œê°€ ì½œë°± ì—­í• 
- ì—¬ëŸ¬ ê°œì˜ ë©”ì†Œë“œë¥¼ ì§€ë‹Œ ì¼ë°˜ì  ì „ëµ íŒ¨í„´ê³¼ ë‹¬ë¦¬, í…œí”Œë¦¿/ì½œë°±ì€Â í•˜ë‚˜ì˜ **ë©”ì„œë“œë¥¼ ê°€ì§„ë‹¤.**
- ì½œë°± ì¸í„°í˜ì´ìŠ¤ ë©”ì†Œë“œì˜ íŒŒë¼ë¯¸í„°ëŠ” ì»¨í…ìŠ¤íŠ¸ ì •ë³´(DB Connection)ë¥¼ ë°›ì„ ë•Œ ì‚¬ìš©í•œë‹¤.

### í…œí”Œë¦¿/ì½œë°± ì‘ì—… íë¦„

![image](https://github.com/user-attachments/assets/0ff09da9-9c08-44e2-8292-1c8a3ef3ac16)

1. í´ë¼ì´ì–¸íŠ¸ê°€ í…œí”Œë¦¿ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ì„œ **`ì½œë°± ê°ì²´ë¥¼ ì „ë‹¬`**í•œë‹¤.
2. í…œí”Œë¦¿ì€ ê³ ì •ëœ ì‘ì—… íë¦„ì„ ì§„í–‰í•˜ë‹¤ê°€ íŠ¹ì • ì‹œì ì— **`ì½œë°± ë©”ì†Œë“œë¥¼ í˜¸ì¶œ`**í•œë‹¤.
3. ì½œë°±ì€ í…œí”Œë¦¿ì´ ì œê³µí•œ ì •ë³´ë¥¼ ì‚¬ìš©í•´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤.
4. í…œí”Œë¦¿ì€ ë°˜í™˜ëœ ê²°ê³¼ë¥¼ ì‚¬ìš©í•´ ì‘ì—…ì„ ë§ˆë¬´ë¦¬í•œë‹¤.

### JdbcContextOll ì ìš©ëœ í…œí”Œë¦¿/ì½œë°±

![image](https://github.com/user-attachments/assets/b16b3953-472d-4d59-a7dc-b035b370d09e)



1. **í´ë¼ì´ì–¸íŠ¸(UserDao)**
    - í…œí”Œë¦¿ ë©”ì†Œë“œ(`workWithStatementStrategy`)ì— ì½œë°± ê°ì²´ë¥¼ ì „ë‹¬
2. **í…œí”Œë¦¿(JdbcContext)**
    - ê³ ì •ëœ ì‘ì—… íë¦„(`Connection` ìƒì„±, `PreparedStatement` ì‹¤í–‰, ìì› ì •ë¦¬ ë“±)ì„ ì§„í–‰
    - íŠ¹ì • ì‹œì ì— ì½œë°± ë©”ì†Œë“œë¥¼ í˜¸ì¶œ
3. **ì½œë°±(ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤)**
    - í…œí”Œë¦¿ì—ì„œ ì „ë‹¬ë°›ì€ ì •ë³´ë¥¼ ì‚¬ìš©í•´ ì‘ì—…(`PreparedStatement` ìƒì„±)ì„ ìˆ˜í–‰
    - ì‘ì—… ê²°ê³¼ë¥¼ í…œí”Œë¦¿ì— ë°˜í™˜

### ì½œë°±ì˜ ë¶„ë¦¬ì™€ ì¬í™œìš©

### **. ë¬¸ì œì **

- ê¸°ì¡´ ë°©ì‹ì—ì„œëŠ” **ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤**ë¥¼ ì‚¬ìš©í•´ ì½œë°± ê°ì²´ë¥¼ ìƒì„±.
- **ë°˜ë³µì ì¸ ìµëª… í´ë˜ìŠ¤ ì‘ì„±**ìœ¼ë¡œ ì¸í•´ ì½”ë“œê°€ ë³µì¡í•˜ê³  ì¬ì‚¬ìš©ì„±ì´ ë–¨ì–´ì§.

### **2. ê°œì„  ë°©ì•ˆ**

- **ì½œë°± ìƒì„± ë¡œì§ì„ ë¶„ë¦¬**í•˜ê³ , ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì†Œë“œë¡œ êµ¬í˜„.
- ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„(í…œí”Œë¦¿ ì½”ë“œ)ê³¼ ë³€í•˜ëŠ” ë¶€ë¶„(SQL ì¿¼ë¦¬)ì„ ëª…í™•íˆ ë¶„ë¦¬.

> **ë³€ê²½ ì „**
> 
- **ë°˜ë³µì ì¸ ìµëª… í´ë˜ìŠ¤ ì‘ì„±**ìœ¼ë¡œ ì¸í•´ ì½”ë“œê°€ ë³µì¡í•˜ê³  ì¬ì‚¬ìš©ì„±ì´ ë–¨ì–´ì§„ë‹¤.
- **`â€˜delete from usersâ€™`**ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ë¶€ë¶„ì€ ì¬í™œìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

```java
public void deleteAll() throws SQLException {
		workWithStatementStrategy(
				new StatementStrategy() {
						public PreparedStatement makePreparedStatement(Connection c)
										throws SQLException {
								return c.prepareStatement("delete from users");
						}
				}
	  };
}
```

> ë³€ê²½ í›„
> 

ë°”ë€Œì§€ ì•ŠëŠ” ë¶€ë¶„ì„ ë¹¼ì„œ executeSql() ë©”ì„œë“œë¡œ ë§Œë“¤ê³ , ë°”ë€ŒëŠ” ë¶€ë¶„ì¸ SQL ë¬¸ì¥ë§Œ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì„œ ì‚¬ìš©í•˜ê²Œ í•œë‹¤.

- SQLì„ ë‹´ì€ íŒŒë¼ë¯¸í„°ë¥¼ finalë¡œ ì„ ì–¸í•´ì„œ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ì¸ í´ë°± ì•ˆì—ì„œ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì•¼ í•œë‹¤.

```java
public void deleteAll() throws SQLException {
		executeSql("delete from users"); 
}

public void executeSql(final String query) throws SQLException {
		workWithStatementStrategy(
				new StatementStrategy() {
						public PreparedStatement makePreparedStatement(Connection c)
										throws SQLException {
								return c.prepareStatement(query);
						}
				}
	  };
}
```

### ì½œë°±ê³¼ í…œí”Œë¦¿ì˜ ê²°í•©

> **`JdbcContext`ë¡œ `executeSql()` ì´ë™**
> 

`executeSql()` ë©”ì†Œë“œëŠ” ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì½œë°±ì´ë¯€ë¡œ ë‹¤ë¥¸ DAOê°€ ê³µìœ í•  ìˆ˜ ìˆëŠ” í…œí”Œë¦¿ í´ë˜ìŠ¤ ì•ˆìœ¼ë¡œ ì˜®ê²¨ë„ ëœë‹¤.

```java
public class JdbcContext {
    public void executeSql(final String query) throws SQLException {
        workWithStatementStrategy(
            new StatementStrategy() {
                @Override
                public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
                    return c.prepareStatement(query);
                }
            }
        );
    }
}

```

```java
public void deleteAll() throws SQLException {
    this.jdbcContext.executeSql("delete from users");
}
```

## 3.6 ìŠ¤í”„ë§ì˜ JdbcTemplate

> **JdbcTemplate**ì€ ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” JDBC ì‘ì—…ì„ ìœ„í•œ í…œí”Œë¦¿/ì½œë°± êµ¬í˜„ì²´
> 

| **í•­ëª©** | **JdbcContext** | **JdbcTemplate** |
| --- | --- | --- |
| **ì½”ë“œ ê°„ê²°ì„±** | ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ì¸í•´ ë‹¤ì†Œ ë³µì¡. | í…œí”Œë¦¿ ë©”ì†Œë“œ í™œìš©ìœ¼ë¡œ ë§¤ìš° ê°„ê²°. |
| **ì¬ì‚¬ìš©ì„±** | ì§ì ‘ êµ¬í˜„í•œ ë©”ì†Œë“œë§Œ ì¬ì‚¬ìš© ê°€ëŠ¥. | ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ë©”ì†Œë“œë¥¼ ë°”ë¡œ ì¬ì‚¬ìš© ê°€ëŠ¥. |
| **ìœ ì—°ì„±** | SQLì— ë”°ë¼ ì§ì ‘ ì½œë°± ì‘ì„± í•„ìš”. | SQLê³¼ íŒŒë¼ë¯¸í„°ë§Œ ì „ë‹¬í•˜ë©´ ì²˜ë¦¬ ê°€ëŠ¥. |
| **í¸ì˜ì„±** | ì œí•œì  í¸ì˜ì„± ì œê³µ. | ë‹¤ì–‘í•œ í¸ì˜ ë©”ì†Œë“œ ì œê³µ. |

### JdbcTemplate ì´ˆê¸°í™”

ìƒì„±ìì˜ íŒŒë¼ë¯¸í„°ë¡œ DataSourceë¥¼ ì£¼ì…

```java
public class UserDao {

    private JdbcTemplate jdbcTemplate;
    private DataSource dataSource;

    public void setDataSource(DataSource dataSource) {
        this.dataSource = dataSource;
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }
}
```

### update()

- **INSERT/UPDATE/DELETE** SQL ì‹¤í–‰ì— ì‚¬ìš©
- `PreparedStatementCreator` ì½œë°±ì„ ì‚¬ìš©í•˜ê±°ë‚˜, ê°„ë‹¨íˆ SQLê³¼ íŒŒë¼ë¯¸í„°ë§Œ ì „ë‹¬ ê°€ëŠ¥

**ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ ë°©ì‹**

```java
public void deleteAll() throws SQLException {
    String query = "delete from users";
    this.jdbcTemplate.update(new PreparedStatementCreator() {
        @Override
        public PreparedStatement createPreparedStatement(Connection con) throws SQLException {
            return con.prepareStatement(query);
        }
    });
}
```

**SQL ì‹¤í–‰**

```java
public void deleteAll() throws SQLException {
    String query = "delete from users";
    this.jdbcTemplate.update(query);
}
```

**íŒŒë¼ë¯¸í„° ë°”ì¸ë”©**

```java
public void add(final User user) {
    String query = "insert into users(id, name, password) values(?, ?, ?)";
    this.jdbcTemplate.update(query, user.getId(), user.getName(), user.getPassword());
}

```

### **queryForObject()**

- **ë‹¨ì¼ ê²°ê³¼ ì¡°íšŒ**ì— ì‚¬ìš©
- `queryForObject()`ëŠ” **ë¡œìš°ê°€ í•˜ë‚˜ë§Œ ë°˜í™˜**ë˜ì§€ ì•Šìœ¼ë©´ ì˜ˆì™¸(`EmptyResultDataAccessException`) ë°œìƒ.

**ë‹¨ì¼ ê°’ ë°˜í™˜**

```java
public int getCount() {
    String query = "select count(*) from users";
    return this.jdbcTemplate.queryForObject(query, Integer.class);
}
```

**ê°ì²´ ë°˜í™˜**

- `RowMapper`ë¥¼ ì‚¬ìš©í•´ ê²°ê³¼ë¥¼ ê°ì²´ë¡œ ë³€í™˜

```java
public User get(String id) {
    String query = "select * from users where id = ?";
    return this.jdbcTemplate.queryForObject(query, new Object[]{id}, new RowMapper<User>() {
        @Override
        public User mapRow(ResultSet rs, int rowNum) throws SQLException {
            User user = new User();
            user.setId(rs.getString("id"));
            user.setName(rs.getString("name"));
            user.setPassword(rs.getString("password"));
            return user;
        }
    });
}

```

### **query()**

- **ë‹¤ì¤‘ ê²°ê³¼ ì¡°íšŒ**ì— ì‚¬ìš©í•˜ë©°, ê²°ê³¼ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜
- `RowMapper`ë¥¼ ì‚¬ìš©í•´ ê²°ê³¼ë¥¼ ë³€í™˜

**ì „ì²´ ë°ì´í„° ì¡°íšŒ**

```java
public List<User> getAll() {
    String query = "select * from users order by id";
    return this.jdbcTemplate.query(query, new RowMapper<User>() {
        @Override
        public User mapRow(ResultSet rs, int rowNum) throws SQLException {
            User user = new User();
            user.setId(rs.getString("id"));
            user.setName(rs.getString("name"));
            user.setPassword(rs.getString("password"));
            return user;
        }
    });
}
```

### ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì½œë°±ì˜ ë¶„ë¦¬

> `get()`ê³¼ `getAll()`ì—ì„œ ë™ì¼í•œ `RowMapper` ì½”ë“œê°€ ë°˜ë³µë˜ë¯€ë¡œ ì´ë¥¼ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ **ë…ë¦½ ê°ì²´**ë¡œ ë¶„ë¦¬í•œë‹¤.
> 

```java
private RowMapper<User> userMapper = new RowMapper<User>() {
    @Override
    public User mapRow(ResultSet rs, int rowNum) throws SQLException {
        User user = new User();
        user.setId(rs.getString("id"));
        user.setName(rs.getString("name"));
        user.setPassword(rs.getString("password"));
        return user;
    }
};
```

```java
public User get(String id) {
    String query = "select * from users where id = ?";
    return this.jdbcTemplate.queryForObject(query, new Object[]{id}, this.userMapper);
}

public List<User> getAll() {
    String query = "select * from users order by id";
    return this.jdbcTemplate.query(query, this.userMapper);
}
```